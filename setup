# If _OLDPATH set PATH to it
# sort of like deactivate
if [ -n "$_OLDPATH" ]
then
    export PATH=$_OLDPATH
    export MANPATH=$_OLDMANPATH
fi

# Reset the traps
trap - ERR SIGINT SIGTERM EXIT

# This gives us the current directory that this script is in
THIS="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Run the installer if needed
if [ ! -e ${THIS}/.virtpath ]
then
    echo "Running one time installer"
    bash ${THIS}/install.sh
    if [ $? -ne 0 ]
    then
        return
    fi
fi

# Get virtpath
. ${THIS}/.virtpath

# Activate virtual environment
. ${virtpath}/bin/activate

# Now modify the PS1 even more than activate does
pushd ${THIS} > /dev/null
gitrev=$(git rev-parse --short HEAD)
PS1=${PS1/)/:$gitrev)}
popd > /dev/null

# Remember the old manpath
_OLDMANPATH=$(manpath)
# Setup the manpath for bwa and samtools
export MANPATH=${virtpath}:$(manpath)
